# Next.jsプロジェクトのVercelデプロイガイド

このガイドでは、Next.jsアプリケーションをVercelにデプロイする手順を詳しく説明します。Vercelは、Next.jsの開発元でもあり、Next.jsアプリケーションのデプロイに最適なプラットフォームです。

## Vercelとは？

Vercelは、フロントエンドプロジェクトのためのクラウドプラットフォームで、以下のような特徴があります：

- **ゼロ設定デプロイ**: 特別な設定なしで、Next.jsアプリをデプロイできる
- **継続的デプロイメント**: GitHubなどのリポジトリと連携し、自動デプロイ
- **グローバルCDN**: 世界中のエッジサーバーで静的コンテンツを配信
- **サーバーレス関数**: APIルートを自動的にサーバーレス関数としてデプロイ
- **プレビュー機能**: プルリクエストごとにプレビューURLを提供

## デプロイの準備

### 1. GitHubリポジトリの作成

まず、あなたのプロジェクトをGitHubリポジトリにプッシュします。

```bash
# Gitリポジトリを初期化（まだ行っていない場合）
git init

# ファイルをステージングエリアに追加
git add .

# 変更をコミット
git commit -m "Initial commit"

# GitHubリポジトリを作成し、プッシュ
git remote add origin https://github.com/あなたのユーザー名/リポジトリ名.git
git push -u origin main
```

### 2. プロジェクトの最終確認

デプロイ前に以下の点を確認しましょう：

- `package.json`に適切なスクリプトが設定されていること
```json
"scripts": {
  "dev": "next dev",
  "build": "next build",
  "start": "next start",
  "lint": "next lint"
}
```

- 環境変数が適切に設定されていること（`.env.local`ではなく、Vercelで設定する必要があります）
- すべての依存関係が`package.json`に記載されていること

## Vercelへのデプロイ手順

### 1. Vercelアカウントの作成

1. [Vercel](https://vercel.com) にアクセスします
2. 「Sign Up」をクリックします
3. GitHubアカウントでサインアップすることをお勧めします（簡単に連携できるため）

### 2. プロジェクトのインポート

1. Vercelダッシュボードで「New Project」（または「Import Project」）をクリックします
2. 「Import Git Repository」セクションから、デプロイしたいGitHubリポジトリを選択します
   - GitHubとの連携がまだの場合は、指示に従って連携を設定します

### 3. プロジェクト設定

1. プロジェクト設定画面で以下の項目を設定します：
   - **Project Name**: プロジェクト名（URLの一部になります）
   - **Framework Preset**: 自動的に「Next.js」が選択されているはずです
   - **Root Directory**: プロジェクトのルートディレクトリ（サブディレクトリにある場合は指定）
   - **Build Command**: 自動的に`next build`が設定されます
   - **Output Directory**: デフォルトのままで問題ありません

2. **環境変数の設定**（必要な場合）
   - 「Environment Variables」セクションで、必要な環境変数を追加します
   - APIキーやデータベース接続情報などの機密情報はここで設定します

![環境変数の設定](https://assets-global.website-files.com/6334a94d77f2afeac05a4eb4/65211e445c022134f62cb868_60ad1a00f3b3f33ff5ae9540_vercel-env.png)

### 4. デプロイ

すべての設定が完了したら、「Deploy」ボタンをクリックします。Vercelは以下の処理を行います：

1. リポジトリからコードを取得
2. 依存関係のインストール
3. ビルドプロセスの実行
4. ビルド成果物のデプロイ
5. CDNによるキャッシングと配信設定

デプロイが完了すると、プロジェクトページに移動し、デプロイの状況と公開URLが表示されます。

## デプロイ後の管理

### ドメインの設定

1. プロジェクト設定の「Domains」タブで、カスタムドメインを追加できます
2. 「Add」ボタンをクリックし、所有しているドメイン名を入力します
3. DNSレコードの設定手順に従ってください

### 継続的デプロイメント

Vercelは、デフォルトで以下の継続的デプロイメント機能を提供します：

- **本番ブランチ**: `main`（または`master`）ブランチへのプッシュで本番環境が更新されます
- **プレビュー環境**: プルリクエストごとに一意のURLを持つプレビュー環境が作成されます
- **自動デプロイ**: コミットごとに自動的にビルドとデプロイが行われます

### 環境変数の管理

環境ごとに異なる環境変数を設定できます：

- **Production**: 本番環境用の環境変数
- **Preview**: プレビュー環境用の環境変数
- **Development**: ローカル開発環境用の環境変数

### デプロイメントの監視

Vercelダッシュボードでは、以下の情報を確認できます：

- デプロイメントのステータスとログ
- パフォーマンス指標
- アクセス統計
- エラーレポート

## トラブルシューティング

### ビルドエラー

ビルド中にエラーが発生した場合：

1. Vercelダッシュボードでデプロイメントを選択し、「Build Logs」を確認
2. エラーメッセージに基づいて問題を修正
3. 修正をコミットしてプッシュすると、自動的に再デプロイされます

### パフォーマンス最適化

- Vercelダッシュボードの「Analytics」タブでパフォーマンス指標を確認
- 画像最適化やコード分割などの最適化を検討
- Next.jsの組み込み機能を活用（Image、Link、動的インポートなど）

## 便利なVercel機能

### Vercel CLI

Vercel CLIを使用すると、コマンドラインからデプロイや設定を管理できます：

```bash
# インストール
npm i -g vercel

# ログイン
vercel login

# デプロイ
vercel

# 本番環境にデプロイ
vercel --prod
```

### Vercel Integrations

Vercelは多くのサービスと統合できます：

- CMS（Contentful, WordPress, Sanity.ioなど）
- 分析ツール（Google Analytics, Fathomなど）
- フォーム処理（Formspree, Formspark）
- コンテンツ配信（Cloudinary, Imgixなど）

## まとめ

Vercelは、Next.jsアプリケーションを簡単にデプロイし、管理するための最適なプラットフォームです。自動デプロイメント、環境ごとのプレビュー、グローバルCDN、サーバーレス関数のサポートなど、多くの機能を提供します。これらの機能を活用して、効率的なデプロイパイプラインを構築しましょう。
